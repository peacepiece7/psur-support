<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.service.demo.domain.user.mapper.UserMapper">

  <resultMap id="UserMap" type="com.service.demo.domain.user.entity.UserEntity">
    <id property="id" column="id"/>
    <result property="loginId" column="login_id"/>
    <result property="username" column="username"/>
    <result property="email" column="email"/>
    <result property="telno" column="telno"/>
    <result property="passwordHash" column="password_hash"/>
    <result property="ci" column="ci"/>
    <result property="status" column="status"/>
    <result property="isActive" column="is_active"/>
    <result property="lastLoginAt" column="last_login_at"/>
    <result property="createdAt" column="created_at"/>
    <result property="updatedAt" column="updated_at"/>
    <result property="deletedAt" column="deleted_at"/>
  </resultMap>

  <insert id="insert" parameterType="com.service.demo.domain.user.entity.UserEntity" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO users (login_id, username, email, telno, password_hash)
    VALUES (#{loginId}, #{username}, #{email}, #{telno}, #{passwordHash})
  </insert>

  <select id="findByLoginId" resultMap="UserMap">
    SELECT * FROM users WHERE login_id = #{loginId} AND deleted_at IS NULL
  </select>

  <select id="findById" resultMap="UserMap">
    SELECT * FROM users WHERE id = #{id} AND deleted_at IS NULL
  </select>

  <update id="updateProfile" parameterType="com.service.demo.domain.user.entity.UserEntity">
    UPDATE users
    SET username = #{username}, email = #{email}, telno = #{telno}
    WHERE id = #{id}
  </update>

  <update id="updatePassword">
    UPDATE users
    SET password_hash = #{passwordHash}
    WHERE id = #{id}
  </update>

  <update id="updateLastLogin">
    UPDATE users
    SET last_login_at = NOW()
    WHERE id = #{id}
  </update>

</mapper>
